version: 2.1

jobs:
  build:
    macos:
      xcode: 13.4
    steps:
##      - run: sw_vers # OS Version 2022/6/3現在 12.3.1
##      - run: xcodebuild -version # Xcode Version 2022/6/3現在 13.4

      # Command Line Toolsのインストール
      - run: |
          curl https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_13.4/Command_Line_Tools_for_Xcode_13.4.dmg -o $HOME/Downloads/Command_Line_Tools_for_Xcode_13.4.dmg
#DEBUG
##      - run: ls -la $HOME/Downloads
#DEBUG
          sudo installer -pkg $HOME/Downloads/Command_Line_Tools_for_Xcode_13.4.dmg -target /

      # # opensslのインストール
      # - run:
      #     name: "openssl 1.1.1n のダウンロード"
      #     command: curl https://www.openssl.org/source/old/1.1.1/openssl-1.1.1n.tar.gz -o $HOME/Downloads/openssl-1.1.1n.tar.gz

      # - run:
      #     name: "openssl 1.1.1n の展開～make～インストール"
      #     command: |
      #       sudo mkdir -p /usr/local/src
      #       cd /usr/local/src
      #       sudo cp -r $HOME/Downloads/openssl-1.1.1n.tar.gz .
      #       sudo tar xzvf openssl-1.1.1n.tar.gz

      # - run:
      #     name: "arm64ビルド用に設定変更"
      #     command: |
      #       cd /usr/local/src
      #       sudo cp -r openssl-1.1.1n openssl-1.1.1n-arm64
      #       cd openssl-1.1.1n-arm64/Configurations
      #       #Start DEBUG
      #       pwd
      #       #End DEBUG
      #       sudo sed -i '' -e "s/-arch arm64/-arch arm64 -mmacosx-version-min=11.0 -isysroot \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk/g" 10-main.conf
      #       sudo sed -i '' -e "s/ios64/macosx/g" 10-main.conf

#Start DEBUG
##      - run: |
##            ls -la /usr/local/src/openssl-1.1.1n-arm64/Configurations
##      - store_artifacts:
##          path: /usr/local/src/openssl-1.1.1n-arm64/Configurations/10-main.conf
#End DEBUG

      # make
#      - run: cd ..
#      - run: ls -la /Users/distiller/project/openssl-1.1.1n-arm64
#      - run: ls -la
#      - run: sudo ./Configure shared enable-rc5 zlib darwin64-arm64-cc no-asm
#      - run: sudo make /Users/distiller/project/openssl-1.1.1n-arm64/makefile
#      - run: sudo make install

      # # x86_64ビルド用に設定変更
      # - run: cd /usr/local/src
      # - run: sudo cp -r openssl-1.1.1n openssl-1.1.1n-x86_64

      # # make
      # - run: cd /usr/local/src/openssl-1.1.1n-x86_64  # /Users/distiller/project/openssl-1.1.1n-x86_64
      # - run: sudo ./Configure darwin64-x86_64-cc shared
      # - run: sudo make install


# Go言語のインストール
##      - run: curl https://go.dev/dl/go1.18.3.darwin-arm64.pkg -o darwin-arm64.pkg
##      - run: ls -la
##      - run: sudo installer -pkg ./darwin-arm64.pkg -target /

#      - run:
#         name: "go install"
#         command: brew install go
##      - run: brew install go@1.17
##      - run: export PATH="/usr/local/opt/go@1.17/bin:$PATH"
##      - run: go version # GO 2022/6/6現在 1.18.3 darwin/amd64

#      - run: mkdir $HOME/go
#      - run: echo 'export GOPATH=$HOME/go' >> $BASH_ENV
##      - run: export

# ソースコードの取得
#      - checkout

workflows:
  job-workflow:
    jobs:
      - build
